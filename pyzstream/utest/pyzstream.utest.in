#!/usr/bin/env bash
#
# pyzstream test runner

projsrcdir=@PROJECT_SOURCE_DIR@
projbindir=@PROJECT_BINARY_DIR@
srcdir=@CMAKE_CURRENT_SOURCE_DIR@

# build directory that contains pyzstream .so
pyzstream_libdir=${projbindir}/pyzstream
pyzstream_srcdir=${projsrcdir}/pyzstream

export PYTHONPATH=${pyzstream_libdir}:${pyzstream_srcdir}:${PYTHONPATH}

usage() {
    echo "$0 [-i | --interactive] [--path] [--shell] [-h | --help | --usage] ARGS" 1>&2
}

help() {
    usage

    cat <<EOF

with no arguments,  run python unit tests
  
Options:
  -u | --usage         brief help message
  --help               this help message
  -i | --interactive   exec python (interactively) with unittest PYTHONPATH
  --path               print PYTHONPATH to console
  --shell              exec bash (interactively) with unittest PYTHONPATH set

EOF
}

usage_flag=0
>>>>>>> Stashed changes
help_flag=0
interactive_flag=0

while [[ $# > 0 ]]; do
    case "$1" in
        -i | --interactive)
            interactive_flag=1
            ;;
        -h | --help | --usage)
            help_flag=1
            ;;
        --shell)
            shell_flag=1
            ;;
        --)
            # forward remaining args to python session
            shift
            break
            ;;
        *)
            usage
            exit 1
            ;;
    esac

    shift
done

if [[ $help_flag -eq 1 ]]; then
    # help message only
    usage
elif [[ $interactive_flag -eq 1 ]]; then
    # interactive python session,  with PYTHONPATH referring to:
    # 1. c++ libraries in build tree
    # 2. python libraries in source tree
    #
    python $@
elif [[ $shell_flag -eq 1 ]]; then
    # run bash.  environment has modified PYTHONPATH
    exec bash
else
    # python module is cmake-examples/pyzstream/utest,
    # which import pyzstream_utest
    #
    python -m unittest utest $@
fi

